# ğŸ“Š DIAGRAMA VISUAL SIMPLIFICADO - VISION

## Vista de Alto Nivel

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    USUARIO (Navegador)          â”‚
                        â”‚                                 â”‚
                        â”‚  â€¢ Chrome/Firefox/Edge/Safari   â”‚
                        â”‚  â€¢ Acceso a cÃ¡mara web          â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   HTTPS (Puerto 5175)   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚                            â”‚
        â†“                            â†“                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React UI    â”‚          â”‚   face-api.js   â”‚         â”‚  Socket.IO       â”‚
â”‚               â”‚          â”‚                 â”‚         â”‚    Client        â”‚
â”‚  â€¢ Dashboard  â”‚          â”‚  â€¢ TensorFlow   â”‚         â”‚                  â”‚
â”‚  â€¢ Detection  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â€¢ Landmarks    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  â€¢ Real-time     â”‚
â”‚  â€¢ Management â”‚          â”‚  â€¢ EAR / MAR    â”‚         â”‚  â€¢ Events        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                â”‚
                                                                â”‚ WSS
                                                                â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      BACKEND (Node.js + Express)              â”‚
        â”‚            Puerto 5005 (HTTPS)                â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                               â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
        â”‚  â”‚   Security   â”‚      â”‚   Socket.IO  â”‚       â”‚
        â”‚  â”‚              â”‚      â”‚    Server    â”‚       â”‚
        â”‚  â”‚  â€¢ JWT       â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
        â”‚  â”‚  â€¢ Helmet    â”‚                             â”‚
        â”‚  â”‚  â€¢ CORS      â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
        â”‚  â”‚  â€¢ Rate Limitâ”‚      â”‚   REST API   â”‚       â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚              â”‚       â”‚
        â”‚                        â”‚  â€¢ /auth     â”‚       â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â€¢ /user     â”‚       â”‚
        â”‚  â”‚     RBAC     â”‚      â”‚  â€¢ /drivers  â”‚       â”‚
        â”‚  â”‚              â”‚      â”‚  â€¢ /alerts   â”‚       â”‚
        â”‚  â”‚  â€¢ admin     â”‚      â”‚  â€¢ /events   â”‚       â”‚
        â”‚  â”‚  â€¢ operator  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
        â”‚  â”‚  â€¢ viewer    â”‚                             â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ MySQL Protocol
                            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          MySQL Database                       â”‚
        â”‚          (sistema_alerta)                     â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                               â”‚
        â”‚     Tablas:                                   â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
        â”‚  â”‚  â€¢ users                            â”‚      â”‚
        â”‚  â”‚  â€¢ drivers                          â”‚      â”‚
        â”‚  â”‚  â€¢ monitoring_sessions              â”‚      â”‚
        â”‚  â”‚  â€¢ drowsiness_events                â”‚      â”‚
        â”‚  â”‚  â€¢ alerts                           â”‚      â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

##  Flujo de DetecciÃ³n de Somnolencia

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CÃMARA   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚ Video Stream
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CLIENTE (Navegador)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚     Video Element                                â”‚
â”‚      â”‚                                           â”‚
â”‚      â†“ Frame cada 100ms (10 FPS)                 â”‚
â”‚                                                  â”‚
â”‚     face-api.js                                  â”‚
â”‚      â”‚                                           â”‚
â”‚      â”œâ”€> Detecta rostro                          â”‚
â”‚      â”œâ”€> 68 puntos faciales                      â”‚
â”‚      â”œâ”€> Calcula EAR (ojos)                      â”‚
â”‚      â”œâ”€> Calcula MAR (boca)                      â”‚
â”‚      â””â”€> Determina nivel                         â”‚
â”‚           â”‚                                      â”‚
â”‚           â”œâ”€> EAR < 0.29  â†’ Ojos cerrados        â”‚
â”‚           â”œâ”€> MAR > 0.45  â†’ Bostezo              â”‚
â”‚           â””â”€> Ambos       â†’ CrÃ­tico              â”‚
â”‚                                                  â”‚
â”‚   Contador de Tiempo                             â”‚
â”‚      â”‚                                           â”‚
â”‚      â”œâ”€> Ojos cerrados Ã— 1.0s   â†’ +1 contador    â”‚
â”‚      â”œâ”€> Bostezo Ã— 1.5s         â†’ +1 contador    â”‚
â”‚      â””â”€> Somnolencia Ã— 1.5s     â†’ +1 + alerta    â”‚
â”‚                                                  â”‚
â”‚     EmisiÃ³n de Evento                            â”‚
â”‚      â”‚                                           â”‚
â”‚      â””â”€> socket.emit('drowsiness_event')         â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ WebSocket
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SERVIDOR (Backend)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚     Socket.IO recibe evento                      â”‚
â”‚      â”‚                                           â”‚
â”‚      â†“                                           â”‚
â”‚                                                  â”‚
â”‚     Valida datos                                 â”‚
â”‚      â”‚                                           â”‚
â”‚      â†“                                           â”‚
â”‚                                                  â”‚
â”‚     Guarda en MySQL                              â”‚
â”‚      â”‚                                           â”‚
â”‚      â”œâ”€> INSERT drowsiness_events                â”‚
â”‚      â”œâ”€> INSERT alerts (si crÃ­tico)              â”‚
â”‚      â””â”€> UPDATE monitoring_sessions              â”‚
â”‚                                                  â”‚
â”‚     Broadcast                                    â”‚
â”‚      â”‚                                           â”‚
â”‚      â””â”€> io.emit('alert_notification')           â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

##  Stack de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               CAPAS DE SEGURIDAD               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Capa 1: TRANSPORTE
    â”œâ”€ HTTPS/TLS (Frontend)
    â”œâ”€ HTTPS/TLS (Backend)
    â””â”€ WSS (WebSocket Secure)
            â”‚
            â†“
     Capa 2: HEADERS (Helmet)
    â”œâ”€ X-Frame-Options
    â”œâ”€ Content-Security-Policy
    â””â”€ HSTS
            â”‚
            â†“
     Capa 3: AUTENTICACIÃ“N
    â”œâ”€ JWT (24h expiration)
    â””â”€ bcrypt (password hash)
            â”‚
            â†“
     Capa 4: AUTORIZACIÃ“N (RBAC)
    â”œâ”€ admin
    â”œâ”€ operator
    â””â”€ viewer
            â”‚
            â†“
     Capa 5: PROTECCIÃ“N
    â”œâ”€ Rate Limiting (500/15min)
    â”œâ”€ CORS configurado
    â”œâ”€ ValidaciÃ³n (Joi)
    â””â”€ SQL Injection protection
            â”‚
            â†“
     Capa 6: AUDITORÃA
    â”œâ”€ Morgan (HTTP logs)
    â”œâ”€ Winston (App logs)
    â””â”€ Timestamps en eventos
```

---

##  TecnologÃ­as por Capa

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Framework:    React 18.2.0                             â”‚
â”‚  Language:     TypeScript 5.3.3                         â”‚
â”‚  Build Tool:   Vite 5.1.3                               â”‚
â”‚  UI Library:   Material-UI 5.15.10                      â”‚
â”‚  Animations:   Framer Motion 11.0.5                     â”‚
â”‚  Routing:      React Router 6.22.1                      â”‚
â”‚  HTTP Client:  Axios 1.6.7                              â”‚
â”‚  WebSocket:    Socket.IO Client 4.8.1                   â”‚
â”‚  Forms:        Formik 2.4.5 + Yup 1.3.3                 â”‚
â”‚  AI/ML:        face-api.js 0.22.2                       â”‚
â”‚                TensorFlow.js 4.22.0                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Runtime:      Node.js 18+                              â”‚
â”‚  Framework:    Express.js 4.21.2                        â”‚
â”‚  WebSocket:    Socket.IO 4.7.4                          â”‚
â”‚  Database:     MySQL2 3.14.1                            â”‚
â”‚  Auth:         JWT 9.0.2 + bcrypt 5.1.1                 â”‚
â”‚  Security:     Helmet 7.1.0 + CORS 2.8.5                â”‚
â”‚  Rate Limit:   express-rate-limit 7.1.5                 â”‚
â”‚  Compression:  compression 1.7.4                        â”‚
â”‚  Upload:       Multer 1.4.5 + Sharp 0.34.2              â”‚
â”‚  Logging:      Morgan 1.10.0 + Winston 3.11.0           â”‚
â”‚  Validation:   Joi 17.11.0                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DBMS:         MySQL 8.0+                               â”‚
â”‚  Engine:       InnoDB                                   â”‚
â”‚  Connection:   Connection Pool (20 max)                 â”‚
â”‚  Indexes:      Optimized for queries                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

##  Algoritmos de DetecciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         EAR (Eye Aspect Ratio)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚         p2        p3                                 â”‚
â”‚          â€¢â”€â”€â”€â”€â”€â”€â”€â”€â€¢                                  â”‚
â”‚        â•±            â•²                                â”‚
â”‚     p1â€¢              â€¢p4                             â”‚
â”‚        â•²            â•±                                â”‚
â”‚          â€¢â”€â”€â”€â”€â”€â”€â”€â”€â€¢                                  â”‚
â”‚         p6        p5                                 â”‚
â”‚                                                      â”‚
â”‚  Formula:  (|p2-p6| + |p3-p5|) / (2 Ã— |p1-p4|)       â”‚
â”‚                                                      â”‚
â”‚  Umbral:   < 0.29 = OJOS CERRADOS                    â”‚
â”‚           >= 0.29 = OJOS ABIERTOS                    â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MAR (Mouth Aspect Ratio)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚                   p14                                â”‚
â”‚                    â€¢                                 â”‚
â”‚               â•±    â”‚    â•²                            â”‚
â”‚          p13â€¢      â”‚      â€¢p17                       â”‚
â”‚               â•²    â”‚    â•±                            â”‚
â”‚                    â€¢                                 â”‚
â”‚                   p20                                â”‚
â”‚                                                      â”‚
â”‚  Formula:  (|p14-p20| + ...) / (2 Ã— |p13-p17|)       â”‚
â”‚                                                      â”‚
â”‚  Umbral:   > 0.45 = BOSTEZO                          â”‚
â”‚           <= 0.45 = NORMAL                           â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Niveles de Somnolencia                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚   NONE     - Todo normal                             â”‚
â”‚   LOW      - Ojos cerrados detectados                â”‚
â”‚   MEDIUM   - Bostezo detectado                       â”‚
â”‚   HIGH     - Ojos cerrados prolongado                â”‚
â”‚   CRITICAL - Ojos cerrados + Bostezo (1.5s)          â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Ciclo de Vida de Request

```
1. AUTENTICACIÃ“N
   â”‚
   â”œâ”€> Cliente envÃ­a: POST /api/auth/login
   â”‚                  { email, password }
   â”‚
   â”œâ”€> Backend valida: bcrypt.compare(password, hash)
   â”‚
   â”œâ”€> Backend genera: jwt.sign({ userId, email, rol })
   â”‚
   â””â”€> Cliente guarda: localStorage.setItem('token')

2. REQUEST AUTENTICADO
   â”‚
   â”œâ”€> Cliente: GET /api/user/profile
   â”‚            Header: Authorization: Bearer <token>
   â”‚
   â”œâ”€> Middleware: authenticateToken()
   â”‚               â”œâ”€> jwt.verify(token)
   â”‚               â””â”€> req.user = { userId, email, rol }
   â”‚
   â”œâ”€> Middleware: authorize(['admin', 'operator'])
   â”‚               â””â”€> Verifica rol en req.user.rol
   â”‚
   â”œâ”€> Controller: userController.getProfile()
   â”‚               â””â”€> Ejecuta lÃ³gica de negocio
   â”‚
   â”œâ”€> Database: SELECT * FROM users WHERE id = ?
   â”‚
   â””â”€> Response: { user: { nombre, correo, ... } }

3. EVENTO EN TIEMPO REAL
   â”‚
   â”œâ”€> Cliente: socket.emit('drowsiness_event', data)
   â”‚
   â”œâ”€> Servidor: socket.on('drowsiness_event', handler)
   â”‚
   â”œâ”€> ValidaciÃ³n: Joi.validate(data)
   â”‚
   â”œâ”€> Database: INSERT INTO drowsiness_events
   â”‚
   â”œâ”€> Broadcast: io.emit('alert_notification', alert)
   â”‚
   â””â”€> Todos los clientes reciben la notificaciÃ³n
```

---

## ğŸ“¦ Despliegue con PM2

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PM2 Process Manager            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  ğŸ“± vision-frontend                    â”‚
â”‚  â”œâ”€ Comando: npm run preview           â”‚
â”‚  â”œâ”€ Puerto: 5175                       â”‚
â”‚  â”œâ”€ Modo: fork                         â”‚
â”‚  â””â”€ Logs: ~/.pm2/logs/                 â”‚
â”‚                                        â”‚
â”‚  ğŸš€ vision-backend                     â”‚
â”‚  â”œâ”€ Comando: npm start                 â”‚
â”‚  â”œâ”€ Puerto: 5005                       â”‚
â”‚  â”œâ”€ Modo: fork                         â”‚
â”‚  â””â”€ Logs: ~/.pm2/logs/                 â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Comandos:
  â€¢ pm2 start ecosystem.config.cjs
  â€¢ pm2 restart all
  â€¢ pm2 logs
  â€¢ pm2 monit
  â€¢ pm2 save
  â€¢ pm2 startup
```

---

## ğŸ¯ Puertos Utilizados

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Puerto  â”‚    Servicio      â”‚ Protocoloâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5175    â”‚  Frontend Vite   â”‚  HTTPS   â”‚
â”‚  5005    â”‚  Backend API     â”‚  HTTPS   â”‚
â”‚  5005    â”‚  Socket.IO       â”‚  WSS     â”‚
â”‚  3306    â”‚  MySQL           â”‚  TCP     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ MÃ©tricas de Performance

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         OPTIMIZACIONES                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Frontend:                              â”‚
â”‚  â€¢ DetecciÃ³n: 10 FPS (100ms interval)   â”‚
â”‚  â€¢ Input Size: 224px (reducido)         â”‚
â”‚  â€¢ Code Splitting: âœ…                   â”‚
â”‚  â€¢ Lazy Loading: âœ…                     â”‚
â”‚                                         â”‚
â”‚  Backend:                               â”‚
â”‚  â€¢ Connection Pool: 20 max              â”‚
â”‚  â€¢ Rate Limit: 500 req/15min            â”‚
â”‚  â€¢ Compression: gzip âœ…                 â”‚
â”‚  â€¢ Static Cache: 1 dÃ­a                  â”‚
â”‚                                         â”‚
â”‚  Database:                              â”‚
â”‚  â€¢ Ãndices optimizados: âœ…              â”‚
â”‚  â€¢ Prepared statements: âœ…              â”‚
â”‚  â€¢ Connection keepalive: âœ…             â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Proyecto:** VISION - Sistema de DetecciÃ³n de Somnolencia
**VersiÃ³n:** 1.0.0
**Autor:** Rogeero Daniel Montufar Merma

